language: java

services:
  - docker

jobs:
  include:
    - stage: test
      jdk: oraclejdk9
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.050
        TARGET="ui"
    - stage: test
      jdk: oraclejdk9
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.140
        TARGET="service/cart"
    - stage: test
      jdk: oraclejdk9
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.00
        TARGET="service/user"
    - stage: test
      jdk: oraclejdk9
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.24
        TARGET="repository/order"
    - stage: test
      jdk: oraclejdk9
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.00
        TARGET="repository/cart"
    - stage: test
      jdk: oraclejdk9
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.120
        TARGET="repository/product"
    - stage: test
      jdk: oraclejdk9
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.24
        TARGET="repository/user"
    - stage: test
      jdk: openjdk10
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.050
        TARGET="ui"
    - stage: test
      jdk: openjdk10
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.140
        TARGET="service/cart"
    - stage: test
      jdk: openjdk10
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.00
        TARGET="service/user"
    - stage: test
      jdk: openjdk10
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.24
        TARGET="repository/order"
    - stage: test
      jdk: openjdk10
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.00
        TARGET="repository/cart"
    - stage: test
      jdk: openjdk10
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.120
        TARGET="repository/product"
    - stage: test
      jdk: openjdk10
      before_script: ./gradlew clean jar
      script:
        - COVERAGE=$COVERAGE ./gradlew -p ./monolithic/$TARGET check
      env:
        COVERAGE=0.24
        TARGET="repository/user"

deploy:
  provider: script
  script: docker --help
  on:
    all_branches: true